<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width", initial-scale=1.0">
    <title>Notation d'une contribution</title>
    <style>
        *{
    margin: 0;
    padding: 0;
}
.rate {
    float: left;
    height: 46px;
    padding: 0 10px;
}
.rate:not(:checked) > input {
    position:absolute;
    top:-9999px;
}
.rate:not(:checked) > label {
    float:right;
    width:1em;
    overflow:hidden;
    white-space:nowrap;
    cursor:pointer;
    font-size:30px;
    color:#ccc;
}
.rate:not(:checked) > label:before {
    content: '★ ';
}
.rate > input:checked ~ label {
    color: #ffc700;    
}
.rate:not(:checked) > label:hover,
.rate:not(:checked) > label:hover ~ label {
    color: #deb217;  
}
.rate > input:checked + label:hover,
.rate > input:checked + label:hover ~ label,
.rate > input:checked ~ label:hover,
.rate > input:checked ~ label:hover ~ label,
.rate > label:hover ~ input:checked ~ label {
    color: #c59b08;
}
    </style>

</head>
<body>
<div>
    <form>
        <select id="listeDesConferencesExistantes" onchange="onListeDesConfChange()">
        </select>
        <select id="listeDesContributionsParConférence"></select>
        <input type="textarea" id="Note" placeholder="Votre note">
        <input type="textarea" name="commentaire" placeholder="Votre commentaire">
        <button onclick="noterConference()">Valider la notation</button>
    </form>
</div>
</body>

<!-- Récupèrer les titres des conférences pour les afficher dans la liste des conférences existantes-->
<script>
    let req = new XMLHttpRequest();
    const confTitres='http://localhost:3002/conferences';

    req.onload = function(){
        if(this.readyState == 4 && this.status == 200){

            let data = JSON.parse(req.responseText)
            let liste = document.getElementById("listeDesConferencesExistantes");
            for (let i = 0 ; i < data.length ; i++){
                let opt = document.createElement('option')
                opt.setAttribute("value", data[i]._id)
                opt.appendChild(document.createTextNode(data[i].titre))
                liste.appendChild(opt)
            }
        }
    }
    req.open("GET", confTitres, true);
    req.send();
</script>

<!-- Afficher les contributions selon la conférence sélectionnée -->
<script>

    function onListeDesConfChange(){
        let listeConf = document.getElementById("listeDesConferencesExistantes")
        let idConfChoisie = listeConf.value;
        console.log(idConfChoisie)
        fetch("http://localhost:3002/conferences/contributions", {method : "GET", headers : new Headers({'content-type' : "application/json"})})
            .then((res) => {
            if(res.status == 200){
                alert("Les contributions ont été récupérées avec succès")
                let listeContrib = document.getElementById("listeDesContributionsParConférence")

            } else if (res.status == 400){
                alert("Erreur dans la récupération des contributions")
            }
        })
        //associer la contrib avec l'id de la conf
    }
    /*let xhr = new XMLHttpRequest();
    const confs='http://localhost:3002/contributions';

    xhr.onreadystatechange = function(){
        if(this.readyState == 4 && this.status == 200){
            let listeConf = document.getElementById("listeDesConferencesExistantes")
            let confChoisie = listeConf.value
            console.log(listeConf)
            console.log(confChoisie)
            let data = JSON.parse(xhr.responseText)
            let liste = document.getElementById("listeDesContributionsParConférence");
            for (let i = 0 ; i < data.length ; i++){
                if(data[i].conference == confChoisie){
                    let opt = document.createElement('option')
                    opt.appendChild(document.createTextNode(data[i].titre))
                    liste.appendChild(opt)
                }

            }
        }
    }
    let data = JSON.parse(xhr.response)
    for (let i = 0 ; i < data.length ; i++) {
        var d_name = data[i].titre;
    }
    var dis_update = function() {

        var conf = document.getElementById("listeDesContributionsParConférence");
        var confChoisie = conf.val
        var dis = $('#listeDesContributionsParConférence').empty();
        for (let i = 0 ; i < data.length ; i++) {
            var d_name = data[i].titre;
            dis.append($('<option>').val(d_name).text(d_name));
        }
    }
    $('#listeDesConferencesExistantes').change(dis_update);
    dis_update();

    xhr.open("GET", confs, true);
    xhr.send();*/


</script>

<!-- Valider la notation d'une contribution -->
<script>
    function noterConference(){

        let noteObjet = {
            conf : document.getElementById("listeDesConferencesExistantes").value,
            contrib : document.getElementById("listeDesContributionsParConférence").value ,
            note : document.getElementById("Note").value,
        }
        console.log(noteObjet)
        fetch("http://localhost:3002/conferences", {method : "POST", headers : new Headers({'content-type' : "application/json","authorization":localStorage.getItem("token")}) ,body : JSON.stringify(noteObjet)}).
        then((res) => {
            if(res.status == 200){
                alert("La notation a été envoyée avec succès")
            } else if (res.status == 400){
                alert("Erreur dans l'envoi de la notation")
            }
        })
    }
</script>

</html>
